{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///D:/test-app2/test-app1/test-app1/src/app/page.tsx"],"sourcesContent":["import { CustomKwRates, CustomRates, DerivedResult, WorkRow, WorkShape } from \"./types\";\n\nexport function thb(n: number) {\n    if (!isFinite(n) || n === null) return \"-\";\n    // ใช้ toLocaleString เพื่อให้แสดงผลเป็น THB และรักษาความแม่นยำ 2 ตำแหน่ง\n    return n.toLocaleString(\"th-TH\", { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n}\n\nexport function num(n: number) {\n    if (!isFinite(n) || n === null) return \"-\";\n    return n.toLocaleString(\"th-TH\", { maximumFractionDigits: 2 });\n}\n\nexport const genId = () => Math.random().toString(36).slice(2, 9);\n\n// *** UTILITY: แปลงค่า String (เช่น \"5:16\") หรือ Number ให้เป็น นาที (Decimal) ***\nexport const parseTimeValueToMinutes = (value: any): number => {\n    const strValue = String(value || '0').trim();\n\n    // 1. รองรับรูปแบบ mm:ss หรือ hh:mm:ss\n    if (strValue.includes(':')) {\n        const parts = strValue.split(':').map((p: string) => parseFloat(p));\n\n        // mm:ss\n        if (parts.length === 2) {\n            return (parts[0] || 0) + (parts[1] || 0) / 60;\n        }\n        // hh:mm:ss\n        if (parts.length === 3) {\n            return (parts[0] * 60) + (parts[1]) + (parts[2] / 60);\n        }\n    }\n\n    // 2. รองรับเลขทศนิยม\n    let num = parseFloat(strValue);\n    if (isNaN(num)) return 0;\n\n    // ถ้าค่าน้อยกว่า 1 และมีจุดทศนิยมยาวๆ อาจเป็น Excel Time Serial (1.0 = 24ชม.)\n    if (num > 0 && num < 1 && String(value).includes('.')) {\n        return num;\n    }\n\n    return num;\n};\n\n\nexport const mapExcelToWorkRow = (data: any[]): WorkRow[] => {\n    if (!data || data.length < 2) return [];\n\n    const newRows: WorkRow[] = data.slice(1).map(row => {\n\n        const dimStr = String(row[1] || '').trim();\n        let finalShape: WorkShape = 'ท่อ (Pipe)';\n        const platePattern = /[0-9]+(\\.[0-9]+)?\\s*[xX]\\s*[0-9]+(\\.[0-9]+)?/;\n        if (platePattern.test(dimStr)) {\n            finalShape = 'แผ่น (Plate)';\n        }\n\n        // *** Logic ใหม่: เก็บค่า Time เป็น String เดิมๆ จาก Excel ***\n\n        // Col 6: Time Nest (หรือ Pierce Count)\n        const col6Raw = String(row[6] || '').trim();\n        let timeNestStr = \"0:00\";\n\n        if (col6Raw.includes(':')) {\n            // เป็นเวลา \"5:16\"\n            timeNestStr = col6Raw;\n        } else if (col6Raw.includes('.') && parseFloat(col6Raw) < 1) {\n            // เป็น Excel Serial Date (0.00xxxx) -> แปลงเป็นนาทีแล้วค่อยเก็บ?\n            const val = parseFloat(col6Raw);\n            if (val >= 1 && !col6Raw.includes('.')) {\n                timeNestStr = \"0:00\"; // Pierce Count, ignore time\n            }\n        } else {\n            // กรณีอื่นๆ เช่น ว่าง หรือ เลข 0\n            if (parseFloat(col6Raw) > 0 && !col6Raw.includes(':')) {\n                timeNestStr = \"0:00\";\n            }\n        }\n\n        // Col 7: Time Part (Process Time)\n        const col7Raw = String(row[7] || '').trim();\n        let timePartStr = col7Raw || \"0:00\";\n\n        return {\n            work: String(row[0] || ''),\n            shape: finalShape,\n            dimension: dimStr,\n            thickness: parseFloat(String(row[2] || 0)),\n            length: parseFloat(String(row[3] || 0)),\n            nesting: parseFloat(String(row[4] || 1)),\n            speed: parseFloat(String(row[5] || 0)),\n            timeNest: timeNestStr, // เก็บเป็น string \"5:16\"\n            timePart: timePartStr, // เก็บเป็น string \"0:32\"\n        }\n    }).filter(r => r.work && r.work.length > 0);\n\n    return newRows;\n};\n\n// **********************************\n// 3. CORE LOGIC (DERIVED COMPUTATION)\n// **********************************\n\nexport const calculateAllDerived = (\n    rows: WorkRow[],\n    customRates: CustomRates,\n    customKwRates: CustomKwRates\n): DerivedResult => {\n\n    // ใช้ parseTimeValueToMinutes แปลง string \"5:16\" เป็นตัวเลข 5.267 นาที เพื่อคำนวณ\n    const totalTimePartOnly = rows.reduce((sum, row) => sum + parseTimeValueToMinutes(row.timePart), 0);\n    const totalTimeAll = rows.reduce((sum, row) => sum +\n        (parseTimeValueToMinutes(row.timePart) + parseTimeValueToMinutes(row.timeNest)), 0);\n\n    // [FIX] Nesting: ถ้าค่าเป็น 0 หรือ Null ให้ปัดเป็น 1 เสมอ เพื่อป้องกันการหารด้วยศูนย์\n    const totalNestingParts = rows.reduce((sum, row) => {\n        const val = parseFloat(String(row.nesting));\n        return sum + (val > 0 ? val : 1);\n    }, 0);\n    \n    const totalJobs = rows.length || 1;\n\n    const minutesPerJob = totalTimeAll / totalJobs;\n    const cuttingMinutesPerJob = totalTimePartOnly / totalJobs;\n\n    const minutesPerPiece = totalNestingParts > 0 ? totalTimeAll / totalNestingParts : 0;\n    const avgNestingParts = totalJobs > 0 ? totalNestingParts / totalJobs : 1;\n\n    const pph = minutesPerPiece > 0 ? 60 / minutesPerPiece : 0;\n\n    const hoursPerMonthPossible = customRates.hoursPerDay * customRates.workingDaysPerMonth;\n    const hoursPerMonth = (hoursPerMonthPossible * customRates.loadFactorPct) / 100.0;\n    const monthlyPieces = pph * hoursPerMonth;\n\n    const monthlyJobs = minutesPerJob > 0 ? (hoursPerMonth * 60) / minutesPerJob : 0;\n\n    const totalKwBeforeLoad = customKwRates.kwItems.reduce((s, it) => s + (Number(it.kw) || 0), 0);\n    // [NOTE] totalKwAfterLoad ใช้สำหรับการคำนวณ Spec ไฟ/Ampere ไม่ใช่ Cost\n    const totalKwAfterLoad = totalKwBeforeLoad * (customRates.loadFactorPct) / 100.0;\n\n    const laserKw = Number(customKwRates.kwItems.find(i => i.id === 'laser')?.kw || 0);\n    const totalKwOther = totalKwBeforeLoad - laserKw;\n    const totalAmpere = (customKwRates.laserAmpere || 0) + (totalKwOther * 1.8);\n\n    // [FIX] ค่าไฟฟ้าต่อนาที ต้องคำนวณจาก kW เต็ม (BeforeLoad) \n    // เพราะเวลาเครื่องจักรทำงานจริง มันกินไฟเต็มกำลัง ไม่ใช่กินไฟตาม Load Factor เฉลี่ย\n    const elecRateTHBPerMin = customRates.elecCostPerKwh / 60.0;\n    const elecPerMin = totalKwBeforeLoad * elecRateTHBPerMin; \n    \n    const airCoolingRateTHBPerMin = customRates.airCompCostPerHr / 60.0;\n    const gasRateTHBPerMin = customRates.gasRateTHBPerMin;\n\n    const elecPerJob = minutesPerJob * elecPerMin;\n    const gasPerJob = cuttingMinutesPerJob * gasRateTHBPerMin;\n\n    const airCoolingPerJob = minutesPerJob * airCoolingRateTHBPerMin;\n    \n    // Spare Parts\n    const sparePartsTHBPerMonth = customRates.baseSparePartTHBPerMonth;\n    const sparePerJob = monthlyJobs > 0 ? sparePartsTHBPerMonth / monthlyJobs : 0;\n\n    const totalPerJob = elecPerJob + gasPerJob + sparePerJob + airCoolingPerJob;\n\n    const elecPerPiece = avgNestingParts > 0 ? elecPerJob / avgNestingParts : 0;\n    const gasPerPiece = avgNestingParts > 0 ? gasPerJob / avgNestingParts : 0;\n    const airCoolingPerPiece = avgNestingParts > 0 ? airCoolingPerJob / avgNestingParts : 0;\n    const sparePerPiece = monthlyPieces > 0 ? sparePartsTHBPerMonth / monthlyPieces : 0; \n    \n    const totalPerPiece = elecPerPiece + gasPerPiece + sparePerPiece + airCoolingPerPiece;\n\n    // Monthly Totals\n    // elecPerMonth คำนวณจาก (CostPerJob * JobsPerMonth) ซึ่งถูกต้องแล้ว \n    // เพราะ JobsPerMonth ถูกลดทอนด้วย Load Factor มาแล้ว\n    const elecPerMonth = elecPerJob * monthlyJobs;\n    const gasPerMonth = gasPerJob * monthlyJobs;\n    const airCoolingPerMonth = airCoolingPerJob * monthlyJobs;\n\n    const totalPerMonthRaw = elecPerMonth + gasPerMonth + sparePartsTHBPerMonth + airCoolingPerMonth;\n\n    return {\n        totalKw: totalKwBeforeLoad,\n        totalKwAfterLoad: totalKwAfterLoad,\n        totalAmpere: totalAmpere,\n        hoursPerMonth,\n        minutesPerPiece,\n        monthlyPieces,\n        avgNestingParts,\n\n        elecPerPiece,\n        sparePerPiece,\n        gasPerPiece,\n        airCoolingPerPiece,\n        totalPerPiece,\n\n        elecPerJob,\n        sparePerJob,\n        gasPerJob,\n        airCoolingPerJob,\n        totalPerJob,\n\n        elecPerMonth: elecPerMonth,\n        gasPerMonth: gasPerMonth,\n        airCoolingPerMonth: airCoolingPerMonth,\n        totalPerMonth: totalPerMonthRaw,\n        totalAnnualCost: totalPerMonthRaw * 12,\n    };\n};"],"names":[],"mappings":"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","debugId":null}}]
}